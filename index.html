<!DOCTYPE html>
<html>
  <head>
    <title>Libros</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./style/style.css" />
    <link rel="icon" sizes="200x200" type="image/png" href="./style/books.png">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet" type="text/css">
  </head>
  <body>

    <div id='barcode-scanner'>
    </div>
    <!--Add buttons to initiate auth sequence and sign out-->
    <button id="authorize_button" style="display: none;">Conectar Aplicaci贸n</button>
    <button id="signout_button" style="display: none;">Salir de Google</button>
    <button id="disconnect_button" style="display: none;">Desconectar Aplicaci贸n</button>
    <button id="escanear">Escanear</button>
    <button id="cerrar" style="display:none;">Cerrar</button>

    <form style="display: none" id="form_sku">
            <label for="Nombres">C贸digo de Barra</label>
            <input type="text" id='codigo_barra' placeholder="">

            <label for="circunscripcion">Descripci贸n del producto</label>
            <input type="text" id='descripcion' placeholder="">
            <label for="local">Cantidad</label>
            <input type="number" id='cantidad' placeholder="">
        <button id="guardar">Guardar</button>
        
    </form>
    <pre id="content"></pre>

    <script type="text/javascript">
      var CLIENT_ID = '983869916425-495k0u2mf6i377r6c04d1nkleek9qbbj.apps.googleusercontent.com';
      var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
      var SCOPES = 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.appdata';

      var authorizeButton = document.getElementById('authorize_button');
      var signoutButton = document.getElementById('signout_button');
      var disconnectButton = document.getElementById('disconnect_button');
      var initialized=false;

      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }
       
      function initClient() {
        gapi.client.init({
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {

          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
          disconnectButton.onclick = disconnect;
        });
      }



   function makeApiCall() {
      var params = {
        spreadsheetId: '1UYFvau6chumF-t7izY-AtOB7TPX_hkEO34uLLWBdIKY',
        range: 'Entradas!A1:E1',
        valueInputOption: 'USER_ENTERED',
        insertDataOption: 'INSERT_ROWS'};
      var params2 = {
        spreadsheetId: '1UYFvau6chumF-t7izY-AtOB7TPX_hkEO34uLLWBdIKY',
        range: 'Entradas!A1:E5'};

      var valueRangeBody = {'values': [['1','2','3','4','7']],'majorDimension':'ROWS'};

      var request = gapi.client.sheets.spreadsheets.values.append(params, valueRangeBody);
      request.then(function(response) {
        console.log(response.result);
      }, function(reason) {
        console.error('error: ' + reason.result.error.message);
      });

	var request2 = gapi.client.sheets.spreadsheets.values.get(params2);
      request2.then(function(response) {
        console.log(response.result);
      }, function(reason) {
        console.error('error: ' + reason.result.error.message);
      });



    }


      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
          disconnectButton.style.display = 'block';
          makeApiCall();
        } 
        else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
          disconnectButton.style.display = 'none';
        }
      }

      function handleAuthClick(event) {
        initialized=true;
        gapi.auth2.getAuthInstance().signIn({ux_mode: "redirect"});
      }

      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut().then(function () {
          location.reload();
        }); 
      }

      function disconnect(event) {
        gapi.auth2.getAuthInstance().disconnect().then(function () {
          signoutButton.click();
        });
      }


      
    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
            <script src="jquery191.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/serratus/quaggaJS/dist/quagga.js"></script>
        <script src="barcode.js"></script>

  </body>
</html>
